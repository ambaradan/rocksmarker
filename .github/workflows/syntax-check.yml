name: Sintax Check
on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]
jobs:
  luacheck:
    name: Luacheck Security Analysis
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v5
      - name: Setup Lua
        uses: leafo/gh-actions-lua@v12
        with:
          luaVersion: "5.1"
      - name: Setup LuaRocks
        uses: leafo/gh-actions-luarocks@v6
      - name: Install Luacheck
        run: luarocks install luacheck
      - name: Run Luacheck with security focus
        run: |
          luacheck lua/ --formatter plain --codes || true
          echo "Security patterns to review manually:"
          echo "- Command execution: os.execute, io.popen"
          echo "- File operations: io.open, io.write"
          echo "- Unsafe string operations: loadstring, dofile"
          grep -r "os\.execute\|io\.popen\|loadstring\|dofile\|load(" lua/ || echo "No obvious security patterns found"
  toml-lint:
    name: TOML Syntax Check
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v5
      - name: Install toml-cli
        run: npm install -g toml-cli
      - name: Validate TOML files
        run: |
          echo "Checking TOML syntax..."
          find . -type f -name "*.toml" -exec toml-lint {} \;
  markdown-lint:
    name: Markdown Lint
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v5
      - name: Install markdownlint-cli
        run: npm install -g markdownlint-cli
      - name: Run markdownlint
        run: |
          echo "Checking markdown files..."
          markdownlint README.md
          markdownlint docs/
  json-lint:
    name: JSON Syntax Check
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v5
      - name: Install jsonlint-cli
        run: npm install -g jsonlint-cli
      - name: Validate JSON files
        run: |
          echo "Checking JSON syntax..."
          find . -type f -name "*.json" -not -path "./node_modules/*" -exec jsonlint-cli {} \;
